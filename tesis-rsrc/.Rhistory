putlabel <- function(x) {
if(is.null(attr(x,"labels"))){
stop("No 'labels' attribute")
} else {
return(factor(x, levels = attr(x,"labels"), labels = names(attr(x,"labels"))))
}
}
data.table(places = "Linux|bmfazio-pc|x86_64|bmfazio", path = "/home/bmfazio/Documents/datasets")[
places == paste(Sys.info()[c(1,4:6)], collapse = "|"), path] -> datadir
if(length(datadir) == 1 & any(dir.exists(datadir))){
datadir <- paste0(datadir, "/inei/endes/")
}
(data.table(haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1")) %>%
merge(rio::import("2017/Modulo64/RECH0.SAV" %>% paste0(datadir,.), setclass = "data.table"), by = "HHID", all.x = TRUE) %>%
merge(rio::import("2017/Modulo65/RECH23.SAV" %>% paste0(datadir,.), setclass = "data.table"), by = "HHID", all.x = TRUE))[,.(
peso=PESO15_AMAS/10**6, estrato.region=putlabel(HV023), estrato.urbrur=HV022, psuid=HV021,
sexo=putlabel(QSSEXO), edad=as.vector(QS23), escolaridad=putlabel(QS25N),
wealth.cat = HV270, wealth.index = HV271,
consume.frut = case_when(QS213U == 3 ~ 0, QS213U == 1 ~ QS213C, TRUE ~ NA_real_),
cant.frut = case_when(QS214U == 1 & QS214C != 9.9 ~ QS214C, TRUE ~ NA_real_),
consume.jugo = case_when(QS215U == 3 ~ 0, QS215U == 1 ~ QS215C, TRUE ~ NA_real_),
cant.jugo = case_when(QS216U == 1 & QS216C != 9.9 ~ QS216C, TRUE ~ NA_real_),
consume.enfr = case_when(QS217U == 3 ~ 0, QS217U == 1 ~ QS217C, TRUE ~ NA_real_),
cant.enfr = case_when(QS216U == 1 & QS216C != 9.9 ~ QS216C, TRUE ~ NA_real_),
consume.enve = case_when(QS219U == 3 ~ 0, QS219U == 1 ~ QS219C, TRUE ~ NA_real_),
cant.enve = case_when(QS220U == 1 ~ QS220CV, QS220U == 2 ~ QS220CC, TRUE ~ NA_real_)
)] -> endes
# graph
# endes$consume.enfr %>% table %>% barplot
# endes$consume.frut %>% table %>% barplot
# endes$consume.jugo %>% table %>% barplot
# endes$consume.enve %>% table %>% barplot
endes
endes$escolaridad %>% is.na %>% table
rio::import("2017/Modulo65/RECH23.SAV" %>% paste0(datadir,.), setclass = "data.table") -> a
a
a$HV210
rio::import("2017/Modulo64/RECH1.SAV" %>% paste0(datadir,.), setclass = "data.table") -> a
a
a$HV106
table(a$HV106)
a
haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1"))
data.table(haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1")) -> b
b
b$HHID %in% a$HHID
b$HHID %in% a$HHID %>% table
b$HHID %>% duplicated %>% table
hhs <- merge(rio::import("2017/Modulo64/RECH1.SAV" %>% paste0(datadir,.), setclass = "data.table"), by = "HHID", all.x = TRUE)
hhs <- rio::import("2017/Modulo64/RECH1.SAV" %>% paste0(datadir,.), setclass = "data.table")
csa <- data.table(haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1"))
hhs$HHID
hhs$HVIDX
table(csa$HHID, hhs$HHID)
table(csa$HHID %in% hhs$HHID)
csa
csa$QSNUMERO
table(csa$QSNUMERO)
table(csa$QSNUMERO);table(hhs$HVIDX)
prop.table(table(csa$QSNUMERO));prop.table(table(hhs$HVIDX))
round(prop.table(table(csa$QSNUMERO)),2);round(prop.table(table(hhs$HVIDX)),2)
csa
hhs$HHID
hhs$HVIDX
sprintf("0%2d")
sprintf("0%2d",1)
sprintf("0d",1)
sprintf("%02d",1)
csa
paste0(csa$HHID,sprintf("%02d",csa$QSNUMERO))
trimws(paste0(csa$HHID,sprintf("%02d",csa$QSNUMERO)))
paste0(hhs$HHID,sprintf("%02d",hhs$HVIDX))
trimws(paste0(hhs$HHID,sprintf("%02d",hhs$HVIDX))) -> idhhs
trimws(paste0(csa$HHID,sprintf("%02d",csa$QSNUMERO))) -> idcsa
is.element(idhhs, idcsa) %>% table
is.element(idcsa, idhhs) %>% table
(paste0(csa$HHID,sprintf("%02d",csa$QSNUMERO))) -> idcsa
(paste0(hhs$HHID,sprintf("%02d",hhs$HVIDX))) -> idhhs
is.element(idcsa, idhhs) %>% table # BIEN!
hhs
?merge
data.table(haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1")) %>% merge(rio::import("2017/Modulo64/RECH1.SAV" %>% paste0(datadir,.), setclass = "data.table"), by.x = c("HHID", "QSNUMERO"), by.y = c("HHID","HVIDX"), all.x = T)
data.table(haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1")) %>% merge(rio::import("2017/Modulo64/RECH1.SAV" %>% paste0(datadir,.), setclass = "data.table"), by.x = c("HHID", "QSNUMERO"), by.y = c("HHID","HVIDX"), all.x = T) %>% nrow
data.table(haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1")) %>% nrow
hhs$HV106
table(hhs$HV106)
(data.table(haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1")) %>%
merge(rio::import("2017/Modulo64/RECH1.SAV" %>% paste0(datadir,.), setclass = "data.table"),
by.x = c("HHID", "QSNUMERO"), by.y = c("HHID","HVIDX"), all.x = T) %>%
merge(rio::import("2017/Modulo64/RECH0.SAV" %>% paste0(datadir,.), setclass = "data.table"), by = "HHID", all.x = TRUE) %>%
merge(rio::import("2017/Modulo65/RECH23.SAV" %>% paste0(datadir,.), setclass = "data.table"), by = "HHID", all.x = TRUE))[,.(
peso=PESO15_AMAS/10**6, estrato.region=putlabel(HV023), estrato.urbrur=HV022, psuid=HV021,
sexo=putlabel(QSSEXO), edad=as.vector(QS23), escolaridad=(putlabel(HV106) %>% ifelse(.=="DK",NA,.)),
wealth.cat = HV270, wealth.index = HV271,
consume.frut = case_when(QS213U == 3 ~ 0, QS213U == 1 ~ QS213C, TRUE ~ NA_real_),
cant.frut = case_when(QS214U == 1 & QS214C != 9.9 ~ QS214C, TRUE ~ NA_real_),
consume.jugo = case_when(QS215U == 3 ~ 0, QS215U == 1 ~ QS215C, TRUE ~ NA_real_),
cant.jugo = case_when(QS216U == 1 & QS216C != 9.9 ~ QS216C, TRUE ~ NA_real_),
consume.enfr = case_when(QS217U == 3 ~ 0, QS217U == 1 ~ QS217C, TRUE ~ NA_real_),
cant.enfr = case_when(QS216U == 1 & QS216C != 9.9 ~ QS216C, TRUE ~ NA_real_),
consume.enve = case_when(QS219U == 3 ~ 0, QS219U == 1 ~ QS219C, TRUE ~ NA_real_),
cant.enve = case_when(QS220U == 1 ~ QS220CV, QS220U == 2 ~ QS220CC, TRUE ~ NA_real_)
)] -> endes
endes
(data.table(haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1")) %>%
merge(rio::import("2017/Modulo64/RECH1.SAV" %>% paste0(datadir,.), setclass = "data.table"),
by.x = c("HHID", "QSNUMERO"), by.y = c("HHID","HVIDX"), all.x = T) %>%
merge(rio::import("2017/Modulo64/RECH0.SAV" %>% paste0(datadir,.), setclass = "data.table"), by = "HHID", all.x = TRUE) %>%
merge(rio::import("2017/Modulo65/RECH23.SAV" %>% paste0(datadir,.), setclass = "data.table"), by = "HHID", all.x = TRUE))[,.(
peso=PESO15_AMAS/10**6, estrato.region=putlabel(HV023), estrato.urbrur=HV022, psuid=HV021,
sexo=putlabel(QSSEXO), edad=as.vector(QS23), escolaridad=(putlabel(HV106)), escold = putlabel(QS25N),
wealth.cat = HV270, wealth.index = HV271,
consume.frut = case_when(QS213U == 3 ~ 0, QS213U == 1 ~ QS213C, TRUE ~ NA_real_),
cant.frut = case_when(QS214U == 1 & QS214C != 9.9 ~ QS214C, TRUE ~ NA_real_),
consume.jugo = case_when(QS215U == 3 ~ 0, QS215U == 1 ~ QS215C, TRUE ~ NA_real_),
cant.jugo = case_when(QS216U == 1 & QS216C != 9.9 ~ QS216C, TRUE ~ NA_real_),
consume.enfr = case_when(QS217U == 3 ~ 0, QS217U == 1 ~ QS217C, TRUE ~ NA_real_),
cant.enfr = case_when(QS216U == 1 & QS216C != 9.9 ~ QS216C, TRUE ~ NA_real_),
consume.enve = case_when(QS219U == 3 ~ 0, QS219U == 1 ~ QS219C, TRUE ~ NA_real_),
cant.enve = case_when(QS220U == 1 ~ QS220CV, QS220U == 2 ~ QS220CC, TRUE ~ NA_real_)
)] -> endes
endes
table(endes$escolaridad, endes$escold)
endes$escolaridad
(data.table(haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1")) %>%
merge(rio::import("2017/Modulo64/RECH1.SAV" %>% paste0(datadir,.), setclass = "data.table"),
by.x = c("HHID", "QSNUMERO"), by.y = c("HHID","HVIDX"), all.x = T) %>%
merge(rio::import("2017/Modulo64/RECH0.SAV" %>% paste0(datadir,.), setclass = "data.table"), by = "HHID", all.x = TRUE) %>%
merge(rio::import("2017/Modulo65/RECH23.SAV" %>% paste0(datadir,.), setclass = "data.table"), by = "HHID", all.x = TRUE))[,.(
peso=PESO15_AMAS/10**6, estrato.region=putlabel(HV023), estrato.urbrur=HV022, psuid=HV021,
sexo=putlabel(QSSEXO), edad=as.vector(QS23), escolaridad=(putlabel(HV106 %>% ifelse(.==8, NA, .))),
wealth.cat = HV270, wealth.index = HV271,
consume.frut = case_when(QS213U == 3 ~ 0, QS213U == 1 ~ QS213C, TRUE ~ NA_real_),
cant.frut = case_when(QS214U == 1 & QS214C != 9.9 ~ QS214C, TRUE ~ NA_real_),
consume.jugo = case_when(QS215U == 3 ~ 0, QS215U == 1 ~ QS215C, TRUE ~ NA_real_),
cant.jugo = case_when(QS216U == 1 & QS216C != 9.9 ~ QS216C, TRUE ~ NA_real_),
consume.enfr = case_when(QS217U == 3 ~ 0, QS217U == 1 ~ QS217C, TRUE ~ NA_real_),
cant.enfr = case_when(QS216U == 1 & QS216C != 9.9 ~ QS216C, TRUE ~ NA_real_),
consume.enve = case_when(QS219U == 3 ~ 0, QS219U == 1 ~ QS219C, TRUE ~ NA_real_),
cant.enve = case_when(QS220U == 1 ~ QS220CV, QS220U == 2 ~ QS220CC, TRUE ~ NA_real_)
)] -> endes
endes$escolaridad
endes$escolaridad %>% table
endes
(data.table(haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1")) %>%
merge(rio::import("2017/Modulo64/RECH1.SAV" %>% paste0(datadir,.), setclass = "data.table"),
by.x = c("HHID", "QSNUMERO"), by.y = c("HHID","HVIDX"), all.x = T) %>%
merge(rio::import("2017/Modulo64/RECH0.SAV" %>% paste0(datadir,.), setclass = "data.table"), by = "HHID", all.x = TRUE) %>%
merge(rio::import("2017/Modulo65/RECH23.SAV" %>% paste0(datadir,.), setclass = "data.table"), by = "HHID", all.x = TRUE))[,.(
peso=PESO15_AMAS/10**6, estrato.region=putlabel(HV023), estrato.urbrur=HV022, psuid=HV021,
sexo=putlabel(QSSEXO), edad=as.vector(QS23), escolaridad=(putlabel(HV106 %>% ifelse(.=="DK", NA, .))),
wealth.cat = HV270, wealth.index = HV271,
consume.frut = case_when(QS213U == 3 ~ 0, QS213U == 1 ~ QS213C, TRUE ~ NA_real_),
cant.frut = case_when(QS214U == 1 & QS214C != 9.9 ~ QS214C, TRUE ~ NA_real_),
consume.jugo = case_when(QS215U == 3 ~ 0, QS215U == 1 ~ QS215C, TRUE ~ NA_real_),
cant.jugo = case_when(QS216U == 1 & QS216C != 9.9 ~ QS216C, TRUE ~ NA_real_),
consume.enfr = case_when(QS217U == 3 ~ 0, QS217U == 1 ~ QS217C, TRUE ~ NA_real_),
cant.enfr = case_when(QS216U == 1 & QS216C != 9.9 ~ QS216C, TRUE ~ NA_real_),
consume.enve = case_when(QS219U == 3 ~ 0, QS219U == 1 ~ QS219C, TRUE ~ NA_real_),
cant.enve = case_when(QS220U == 1 ~ QS220CV, QS220U == 2 ~ QS220CC, TRUE ~ NA_real_)
)] -> endes
endes$escolaridad %>% table
hhs$HV106
putlabel(hhs$HV106)
(putlabel(hhs$HV106) == "DK") %>% table
ifelse(putlabel(hhs$HV106) == "DK", NA, putlabel(hhs$HV106))
ifelse(putlabel(hhs$HV106) == "DK", NA)
ifelse(putlabel(hhs$HV106) == "DK", NA, putlabel(hhs$HV106))
?ifelse
putlabel(hhs$HV106)
putlabel
putlabel(hhs$HV106)
putlabel == "DK"
putlabel(hhs$HV106)
case_when(hhs$HV106 == "DK", 1, 0)
HV106
hhs$HV106
hhs$HV106 %>% ifelse(.==8, NA, .)
hhs$HV106 %>% ifelse(.==8, NA, .) %>% factor(., hhs$HV106 %>% attr("labels"))
hhs$HV106 %>% attr("labels")
hhs$HV106 %>% ifelse(.==8, NA, .) %>% factor(., names(hhs$HV106 %>% attr("labels")))
hhs$HV106 %>% ifelse(.==8, NA, .) %>% factor(., labels = names(hhs$HV106 %>% attr("labels")))
hhs$HV106 %>% ifelse(.==8, NA, .) %>% factor(., labels = names(hhs$HV106 %>% attr("labels"))[-5])
(data.table(haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1")) %>%
merge(rio::import("2017/Modulo64/RECH1.SAV" %>% paste0(datadir,.), setclass = "data.table"),
by.x = c("HHID", "QSNUMERO"), by.y = c("HHID","HVIDX"), all.x = T) %>%
merge(rio::import("2017/Modulo64/RECH0.SAV" %>% paste0(datadir,.), setclass = "data.table"), by = "HHID", all.x = TRUE) %>%
merge(rio::import("2017/Modulo65/RECH23.SAV" %>% paste0(datadir,.), setclass = "data.table"), by = "HHID", all.x = TRUE))[,.(
peso=PESO15_AMAS/10**6, estrato.region=putlabel(HV023), estrato.urbrur=HV022, psuid=HV021,
sexo=putlabel(QSSEXO), edad=as.vector(QS23),
escolaridad=HV106 %>% ifelse(.==8,NA,.) %>% factor(.,labels=names(HV106 %>% attr("labels"))[-5]),
wealth.cat = HV270, wealth.index = HV271,
consume.frut = case_when(QS213U == 3 ~ 0, QS213U == 1 ~ QS213C, TRUE ~ NA_real_),
cant.frut = case_when(QS214U == 1 & QS214C != 9.9 ~ QS214C, TRUE ~ NA_real_),
consume.jugo = case_when(QS215U == 3 ~ 0, QS215U == 1 ~ QS215C, TRUE ~ NA_real_),
cant.jugo = case_when(QS216U == 1 & QS216C != 9.9 ~ QS216C, TRUE ~ NA_real_),
consume.enfr = case_when(QS217U == 3 ~ 0, QS217U == 1 ~ QS217C, TRUE ~ NA_real_),
cant.enfr = case_when(QS216U == 1 & QS216C != 9.9 ~ QS216C, TRUE ~ NA_real_),
consume.enve = case_when(QS219U == 3 ~ 0, QS219U == 1 ~ QS219C, TRUE ~ NA_real_),
cant.enve = case_when(QS220U == 1 ~ QS220CV, QS220U == 2 ~ QS220CC, TRUE ~ NA_real_)
)] -> endes
endes
rio::import("2017/Modulo65/RECH23.SAV" %>% paste0(datadir,.), setclass = "data.table") -> a
a
a$SHREGION
a$SHPROVIN
a$SHDISTRI
a$SHREGION
a$SHREGION %>% table
a$HV023 %>% table
endes$HV23
endes$estrato.region
(data.table(haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1")) %>%
merge(rio::import("2017/Modulo64/RECH1.SAV" %>% paste0(datadir,.), setclass = "data.table"),
by.x = c("HHID", "QSNUMERO"), by.y = c("HHID","HVIDX"), all.x = T) %>%
merge(rio::import("2017/Modulo64/RECH0.SAV" %>% paste0(datadir,.), setclass = "data.table"), by = "HHID", all.x = TRUE) %>%
merge(rio::import("2017/Modulo65/RECH23.SAV" %>% paste0(datadir,.), setclass = "data.table"), by = "HHID", all.x = TRUE))[,.(
peso=PESO15_AMAS/10**6, estrato.region=putlabel(HV023), estrato.urbrur=HV022, psuid=HV021,
region.natural=putlabel(SHREGION), ubigeo=paste0(sprintf("%02d",HV023),sprintf("%02d",SHPROVIN),sprintf("%02d",SHDISTRI)),
sexo=putlabel(QSSEXO), edad=as.vector(QS23),
escolaridad=HV106 %>% ifelse(.==8,NA,.) %>% factor(.,labels=names(HV106 %>% attr("labels"))[-5]),
wealth.cat = HV270, wealth.index = HV271,
consume.frut = case_when(QS213U == 3 ~ 0, QS213U == 1 ~ QS213C, TRUE ~ NA_real_),
cant.frut = case_when(QS214U == 1 & QS214C != 9.9 ~ QS214C, TRUE ~ NA_real_),
consume.jugo = case_when(QS215U == 3 ~ 0, QS215U == 1 ~ QS215C, TRUE ~ NA_real_),
cant.jugo = case_when(QS216U == 1 & QS216C != 9.9 ~ QS216C, TRUE ~ NA_real_),
consume.enfr = case_when(QS217U == 3 ~ 0, QS217U == 1 ~ QS217C, TRUE ~ NA_real_),
cant.enfr = case_when(QS216U == 1 & QS216C != 9.9 ~ QS216C, TRUE ~ NA_real_),
consume.enve = case_when(QS219U == 3 ~ 0, QS219U == 1 ~ QS219C, TRUE ~ NA_real_),
cant.enve = case_when(QS220U == 1 ~ QS220CV, QS220U == 2 ~ QS220CC, TRUE ~ NA_real_)
)] -> endes
endes
table(endes$ubigeo)
endes
csa$QSINTM
data.table(haven::read_sav("2017/Modulo66/REC0111.sav" %>% paste0(datadir,.), encoding = "latin1")) -> a
library(dplyr);library(data.table)
putlabel <- function(x) {
if(is.null(attr(x,"labels"))){
stop("No 'labels' attribute")
} else {
return(factor(x, levels = attr(x,"labels"), labels = names(attr(x,"labels"))))
}
}
data.table(places = "Linux|bmfazio-pc|x86_64|bmfazio", path = "/home/bmfazio/Documents/datasets")[
places == paste(Sys.info()[c(1,4:6)], collapse = "|"), path] -> datadir
if(length(datadir) == 1 & any(dir.exists(datadir))){
datadir <- paste0(datadir, "/inei/endes/")
}
data.table(haven::read_sav("2017/Modulo66/REC0111.sav" %>% paste0(datadir,.), encoding = "latin1")) -> a
data.table(haven::read_sav(/home/bmfazio/Documents/datasets/inei/endes/2017/Modulo66/REC0111.SAV, encoding = "latin1")) -> a
data.table(haven::read_sav("/home/bmfazio/Documents/datasets/inei/endes/2017/Modulo66/REC0111.SAV", encoding = "latin1")) -> a
a
a$V102
a$V103
a$V104
a$V105
a
a$AWFACTE
a
a$V190
a
a$V003
(data.table(haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1")) %>%
merge(rio::import("2017/Modulo66/REC0111.SAV" %>% paste0(datadir,.), setclass = "data.table"),
by.x = c("HHID", "QSNUMERO"), by.y = c("hhid","V003"), all.x = T)
data.table(haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1")) %>%
merge(rio::import("2017/Modulo66/REC0111.SAV" %>% paste0(datadir,.), setclass = "data.table"),
by.x = c("HHID", "QSNUMERO"), by.y = c("hhid","V003"), all.x = T)  -> a
dim(a)
a
data.table(haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1")) %>%
merge(rio::import("2017/Modulo66/REC0111.SAV" %>% paste0(datadir,.), setclass = "data.table"),
by.x = c("HHID", "QSNUMERO"), by.y = c("hhid","V003"))
data.table(haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1")) %>%
merge(rio::import("2017/Modulo66/REC0111.SAV" %>% paste0(datadir,.), setclass = "data.table"),
by.x = c("HHID", "QSNUMERO"), by.y = c("hhid","V003"))  -> a
dim(a)
a$QSSEXO %>% table
data.table(haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1"))$QSSEXO
data.table(haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1"))$QSSEXO %>% table
a
a$V103
a$V104
a$V104
a
a$QS23
a$QS23 < a$V104
a$QS23 < a$V104 %>% table
(a$QS23 < a$V104) %>% table
a[,.(QS23,V104)]
a[V104<=94,.(QS23,V104)]
a[V104<=94 & V104 > QS23,.(QS23,V104)]
a[V104<=94 & V104 >= QS23,.(QS23,V104)]
a$V104 %>% ifelse(. > 94, NA, .)
table(a$V104 %>% ifelse(. > 94, NA, .))
hist(a$V104 %>% ifelse(. > 94, NA, .))
a$V104
a$V105
a$QS23
a$$V104
a$V104
a$V105
a$V105
a$V106
(data.table(haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1")) %>%
merge(rio::import("2017/Modulo66/REC0111.SAV" %>% paste0(datadir,.), setclass = "data.table"),
by.x = c("HHID", "QSNUMERO"), by.y = c("hhid","V003"), all.x = T) %>%
merge(rio::import("2017/Modulo64/RECH1.SAV" %>% paste0(datadir,.), setclass = "data.table"),
by.x = c("HHID", "QSNUMERO"), by.y = c("HHID","HVIDX"), all.x = T) %>%
merge(rio::import("2017/Modulo64/RECH0.SAV" %>% paste0(datadir,.), setclass = "data.table"), by = "HHID", all.x = TRUE) %>%
merge(rio::import("2017/Modulo65/RECH23.SAV" %>% paste0(datadir,.), setclass = "data.table"), by = "HHID", all.x = TRUE))[,.(
peso=PESO15_AMAS/10**6, estrato.region=putlabel(HV023), estrato.urbrur=HV022, psuid=HV021,
region.natural=putlabel(SHREGION), ubigeo=paste0(sprintf("%02d",HV023),sprintf("%02d",SHPROVIN),sprintf("%02d",SHDISTRI)),
residencia.infancia = putlabel(V103), tiempo.resactual = V104 %>% ifelse(. > 95, NA, .) %>% ifelse(. == 95, QS23, .),
residencia.previa = putlabel(V105),
sexo=putlabel(QSSEXO), edad=as.vector(QS23), mes.encuesta = putlabel(QSINTM),
escolaridad=HV106 %>% ifelse(.==8,NA,.) %>% factor(.,labels=names(HV106 %>% attr("labels"))[-5]),
wealth.cat = HV270, wealth.index = HV271,
consume.frut = case_when(QS213U == 3 ~ 0, QS213U == 1 ~ QS213C, TRUE ~ NA_real_),
cant.frut = case_when(QS214U == 1 & QS214C != 9.9 ~ QS214C, TRUE ~ NA_real_),
consume.jugo = case_when(QS215U == 3 ~ 0, QS215U == 1 ~ QS215C, TRUE ~ NA_real_),
cant.jugo = case_when(QS216U == 1 & QS216C != 9.9 ~ QS216C, TRUE ~ NA_real_),
consume.enfr = case_when(QS217U == 3 ~ 0, QS217U == 1 ~ QS217C, TRUE ~ NA_real_),
cant.enfr = case_when(QS216U == 1 & QS216C != 9.9 ~ QS216C, TRUE ~ NA_real_),
consume.enve = case_when(QS219U == 3 ~ 0, QS219U == 1 ~ QS219C, TRUE ~ NA_real_),
cant.enve = case_when(QS220U == 1 ~ QS220CV, QS220U == 2 ~ QS220CC, TRUE ~ NA_real_)
)] -> endes
endes
endes$tiempo.resactual %>% is.na %>% table
endes$consume.enfr %>% table %>% barplot
endes$consume.frut %>% table %>% barplot
endes$consume.jugo %>% table %>% barplot
endes$consume.enve %>% table %>% barplot
?barplot
endes$consume.enfr %>% table %>% prop.table %>% barplot
endes$consume.frut %>% table %>% prop.table %>% barplot
endes$consume.frut %>% table %>% prop.table %>% barplot
endes$consume.jugo %>% table %>% prop.table %>% barplot
endes$consume.enve %>% table %>% prop.table %>% barplot
endes$consume.enfr %>% table %>% barplot
endes$consume.enfr %>% table %>% prop.table %>% barplot
endes$consume.frut %>% table %>% prop.table %>% barplot
endes$consume.frut %>% table %>% barplot
endes$consume.frut %>% table %>% prop.table %>% barplot
endes$consume.enve %>% table %>% prop.table %>% barplot
endes$consume.jugo %>% table %>% prop.table %>% barplot
endes
library(dplyr);library(data.table)
putlabel <- function(x) {
if(is.null(attr(x,"labels"))){
stop("No 'labels' attribute")
} else {
return(factor(x, levels = attr(x,"labels"), labels = names(attr(x,"labels"))))
}
}
data.table(places = "Linux|bmfazio-pc|x86_64|bmfazio", path = "/home/bmfazio/Documents/datasets")[
places == paste(Sys.info()[c(1,4:6)], collapse = "|"), path] -> datadir
if(length(datadir) == 1 & any(dir.exists(datadir))){
datadir <- paste0(datadir, "/inei/endes/")
}
(data.table(haven::read_sav("2017/Modulo414/CSALUD01.sav" %>% paste0(datadir,.), encoding = "latin1")) %>%
merge(rio::import("2017/Modulo66/REC0111.SAV" %>% paste0(datadir,.), setclass = "data.table"),
by.x = c("HHID", "QSNUMERO"), by.y = c("hhid","V003"), all.x = T) %>%
merge(rio::import("2017/Modulo64/RECH1.SAV" %>% paste0(datadir,.), setclass = "data.table"),
by.x = c("HHID", "QSNUMERO"), by.y = c("HHID","HVIDX"), all.x = T) %>%
merge(rio::import("2017/Modulo64/RECH0.SAV" %>% paste0(datadir,.), setclass = "data.table"), by = "HHID", all.x = TRUE) %>%
merge(rio::import("2017/Modulo65/RECH23.SAV" %>% paste0(datadir,.), setclass = "data.table"), by = "HHID", all.x = TRUE))[,.(
peso=PESO15_AMAS/10**6, estrato.region=putlabel(HV023), estrato.urbrur=HV022, psuid=HV021,
region.natural=putlabel(SHREGION), ubigeo=paste0(sprintf("%02d",HV023),sprintf("%02d",SHPROVIN),sprintf("%02d",SHDISTRI)),
residencia.infancia = putlabel(V103), tiempo.resactual = V104 %>% ifelse(. > 95, NA, .) %>% ifelse(. == 95, QS23, .),
residencia.previa = putlabel(V105),
sexo=putlabel(QSSEXO), edad=as.vector(QS23), mes.encuesta = putlabel(QSINTM),
escolaridad=HV106 %>% ifelse(.==8,NA,.) %>% factor(.,labels=names(HV106 %>% attr("labels"))[-5]),
wealth.cat = HV270, wealth.index = HV271,
consume.frut = case_when(QS213U == 3 ~ 0, QS213U == 1 ~ QS213C, TRUE ~ NA_real_),
cant.frut = case_when(QS214U == 1 & QS214C != 9.9 ~ QS214C, TRUE ~ NA_real_),
consume.jugo = case_when(QS215U == 3 ~ 0, QS215U == 1 ~ QS215C, TRUE ~ NA_real_),
cant.jugo = case_when(QS216U == 1 & QS216C != 9.9 ~ QS216C, TRUE ~ NA_real_),
consume.enfr = case_when(QS217U == 3 ~ 0, QS217U == 1 ~ QS217C, TRUE ~ NA_real_),
cant.enfr = case_when(QS216U == 1 & QS216C != 9.9 ~ QS216C, TRUE ~ NA_real_),
consume.enve = case_when(QS219U == 3 ~ 0, QS219U == 1 ~ QS219C, TRUE ~ NA_real_),
cant.enve = case_when(QS220U == 1 ~ QS220CV, QS220U == 2 ~ QS220CC, TRUE ~ NA_real_)
)] -> endes
# graph
# endes$consume.enfr %>% table %>% prop.table %>% barplot
# endes$consume.frut %>% table %>% prop.table %>% barplot
# endes$consume.jugo %>% table %>% prop.table %>% barplot
# endes$consume.enve %>% table %>% prop.table %>% barplot
endes
install.packages("bayesplot")
install.packages("gmailr")
install.packages("tidyverse")
install.packages("drake")
`+`
`+` <- 1
1+1
`+` <- -
`+` <- `-`
1-1
1+1
10+1+
10+1+6
10+1
10+1+6
rm(`+`)
1+1
source('~/git-repos/tesis-pucpstat/tesis-rsrc/MAIN.R')
?file
?file.path
file.path("x",x)
file.path("x","x")
file.path
parallel::detectCores()
library(dplyr)
library(gmailr)
library(data.table)
library(bayesplot)
library(rstan)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
library(dplyr)
library(gmailr)
install.packages("gmailr")
install.packages("gmailr")
library(data.table)
library(bayesplot)
library(rstan)
install.packages("rstan")
fx <- inline::cxxfunction( signature(x = "integer", y = "numeric" ) , '
return ScalarReal( INTEGER(x)[0] * REAL(y)[0] ) ;
' )
fx( 2L, 5 ) # should be 10
library(rstan)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
70
70
70
70
70
70
70
60
60
60
60
60
60
library(drake)
library(dplyr)
library(gmailr)
library(data.table)
library(bayesplot)
library(rstan)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
beta.reparam <- function(mu, rho) {
if (all(0 < mu & mu < 1 & 0 < rho)) {
list(shape1 = mu / rho,
shape2 = (1 - mu) / rho)
} else {
stop("Parameters are out of bounds")
}
}
beta.reparam(0,0)
beta.reparam(0,0) -> a
a
dbeta(0.5,1,1)
dbeta(0.75,1,1)
dbeta(0.99,1,1)
dbeta(0.5,1,1)
curve(dbeta(x,1,1))
curve(dbeta(x,2,1))
curve(dbeta(x,3,1))
curve(dbeta(x,5,1))
curve(dbeta(x,50,1))
curve(dbeta(x,1,50))
rbeta.reparam <- function(n,mu,rho)with(reparam.beta(mu,rho),
rbeta(n,alpha,beta))
rbeta.reparam()
rbeta.reparam(
rbeta.reparam
rbeta.reparam
try
tries
getwd()
dir()
read.table("config.txt")
read.table("config.txt", sep = ";")
read.table("config.txt", sep = ";")[,1]
library(tidyverse)
install.packages("tidyverse")
df <- data.frame(abc = 1, xyz = "a")
df$x
df[, "xyz"]
df[, c("abc", "xyz")]
df <- data.frame(xbc = 1, xyz = "a")
df$x
df[, "xyz"]
df[, c("abc", "xyz")]
annoying <- tibble(
`1` = 1:10,
`2` = `1` * 2 + rnorm(length(`1`))
)
library(tidyverse)
annoying <- tibble(
`1` = 1:10,
`2` = `1` * 2 + rnorm(length(`1`))
)
annoying
annoying$`1`
